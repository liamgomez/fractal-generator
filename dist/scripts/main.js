"use strict";L.Control.Fullscreen=L.Control.extend({options:{position:"topleft",title:{false:"View Fullscreen",true:"Exit Fullscreen"}},onAdd:function(e){var r=L.DomUtil.create("div","leaflet-control-fullscreen leaflet-bar leaflet-control");return this.link=L.DomUtil.create("a","leaflet-control-fullscreen-button leaflet-bar-part",r),this.link.href="#",this._map=e,this._map.on("fullscreenchange",this._toggleTitle,this),this._toggleTitle(),L.DomEvent.on(this.link,"click",this._click,this),r},_click:function(e){L.DomEvent.stopPropagation(e),L.DomEvent.preventDefault(e),this._map.toggleFullscreen(this.options)},_toggleTitle:function(){this.link.title=this.options.title[this._map.isFullscreen()]}}),L.Map.include({isFullscreen:function(){return this._isFullscreen||!1},toggleFullscreen:function(e){var r=this.getContainer();this.isFullscreen()?e&&e.pseudoFullscreen?this._disablePseudoFullscreen(r):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():this._disablePseudoFullscreen(r):e&&e.pseudoFullscreen?this._enablePseudoFullscreen(r):r.requestFullscreen?r.requestFullscreen():r.mozRequestFullScreen?r.mozRequestFullScreen():r.webkitRequestFullscreen?r.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):r.msRequestFullscreen?r.msRequestFullscreen():this._enablePseudoFullscreen(r)},_enablePseudoFullscreen:function(e){L.DomUtil.addClass(e,"leaflet-pseudo-fullscreen"),this._setFullscreen(!0),this.invalidateSize(),this.fire("fullscreenchange")},_disablePseudoFullscreen:function(e){L.DomUtil.removeClass(e,"leaflet-pseudo-fullscreen"),this._setFullscreen(!1),this.invalidateSize(),this.fire("fullscreenchange")},_setFullscreen:function(e){this._isFullscreen=e;var r=this.getContainer();e?L.DomUtil.addClass(r,"leaflet-fullscreen-on"):L.DomUtil.removeClass(r,"leaflet-fullscreen-on")},_onFullscreenChange:function(e){var r=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;r!==this.getContainer()||this._isFullscreen?r!==this.getContainer()&&this._isFullscreen&&(this._setFullscreen(!1),this.fire("fullscreenchange")):(this._setFullscreen(!0),this.fire("fullscreenchange"))}}),L.Map.mergeOptions({fullscreenControl:!1}),L.Map.addInitHook(function(){this.options.fullscreenControl&&(this.fullscreenControl=new L.Control.Fullscreen(this.options.fullscreenControl),this.addControl(this.fullscreenControl));var e;if("onfullscreenchange"in document?e="fullscreenchange":"onmozfullscreenchange"in document?e="mozfullscreenchange":"onwebkitfullscreenchange"in document?e="webkitfullscreenchange":"onmsfullscreenchange"in document&&(e="MSFullscreenChange"),e){var r=L.bind(this._onFullscreenChange,this);this.whenReady(function(){L.DomEvent.on(document,e,r)}),this.on("unload",function(){L.DomEvent.off(document,e,r)})}}),L.control.fullscreen=function(e){return new L.Control.Fullscreen(e)},L.GridLayer.FractalLayer=L.GridLayer.extend({options:{maxZoom:23,noWrap:!0,updateInterval:100},initialize:function(e){this.fractalType=e.type,this.cr=e.juliaCR,this.ci=e.juliaCI,this.maxIter=e.maxItt,this.colors=[],this.colors.push(e.fractalColor1),this.colors.push(e.fractalColor2),this.colors.push(e.fractalColor3),this.colors.push(e.fractalColor4),this.customColors=e.customColors;var r={grayscale:[[0,0,0,255]],orange:[[255,255,127,0],[255,127,0,63],[191,0,0,127],[0,0,0,255]],test:[[255,147,79],[194,232,18],[182,239,212],[0,255,255,63],[0,0,255,95],[127,0,255,127],[255,255,255,254],[0,0,0,255]],blue:[[63,63,255,0],[255,127,0,63],[191,0,0,127],[0,0,0,255]],rainbow:[[127,0,255,0],[0,0,255,31],[0,255,255,63],[0,255,0,95],[255,255,0,127],[255,0,0,191],[0,0,0,255]],wobniar:[[255,0,0,0],[255,255,0,15],[0,255,0,39],[0,255,255,63],[0,0,255,95],[127,0,255,127],[255,255,255,254],[0,0,0,255]],YourColor:[]},o=e.fractalColor1,l=e.fractalColor2,t=e.fractalColor3,n=e.fractalColor4;o.push(0),l.push(80),t.push(160),n.push(255),r.YourColor.push(o),r.YourColor.push(l),r.YourColor.push(t),r.YourColor.push(n),this.presetMap=this.generateColors(r[e.colorPreset])},createTile:function(e,r){var o=document.createElement("canvas"),l=this,t=this.getTileSize();o.setAttribute("width",t.x),o.setAttribute("height",t.y);var n=o.getContext("2d"),a=n.getImageData(0,0,256,256),s=(this.colorMap,new Worker("./scripts/MapWorker.js"));l.colorMap;return s.postMessage({do:"start",x:e.x,y:e.y,z:e.z,maxIter:l.maxIter,type:l.fractalType,cr:l.cr,ci:l.ci,img:a,presetMap:l.presetMap}),s.onmessage=function(e){n.putImageData(e.data.canvas_image,0,0),s.terminate(),s=void 0,r(null,o)},o},generateColors:function(e){for(var r=[],o=255,l=255,t=255,n=0;n<e.length;n++){for(var a=e[n][0],s=e[n][1],i=e[n][2],c=e[n][3],u=r.length,f=u;f<c;f++){var C=(f-u)/(c-u);r[f]=[o*(1-C)+a*C|0,l*(1-C)+s*C|0,t*(1-C)+i*C|0]}o=a,l=s,t=i}return r.push([o,l,t]),r}}),L.gridLayer.fractalLayer=function(e){return new L.GridLayer.FractalLayer(e)};var map=L.map("fractal_map",{minZoom:1,fullscreenControl:{pseudoFullscreen:!1}});map.setView([0,-90],2);var numWorkers=3,fractalController={appControls:{type:"mandlebrot",fractalColor1:randomColor({luminosity:"random",format:"rgbArray"}),fractalColor2:randomColor({luminosity:"random",format:"rgbArray"}),fractalColor3:randomColor({luminosity:"random",format:"rgbArray"}),fractalColor4:randomColor({luminosity:"random",format:"rgbArray"}),juliaCR:-.74543,juliaCI:.11301,maxItt:300,colorPreset:"YourColor"},activeLayer:null,currentType:null,setLayer:function(e){this.activeLayer&&this.activeLayer.remove(),this.activeLayer=L.gridLayer.fractalLayer(this.appControls),this.currentType=e,this.activeLayer.addTo(map)},reloadLayer:function(){this.activeLayer.remove(),this.activeLayer=L.gridLayer.fractalLayer(this.appControls),this.activeLayer.addTo(map)},randomizeColors:function(){this.appControls.fractalColor1=randomColor({luminosity:"random",format:"rgbArray"}),this.appControls.fractalColor2=randomColor({luminosity:"random",format:"rgbArray"}),this.appControls.fractalColor3=randomColor({luminosity:"random",format:"rgbArray"}),this.appControls.fractalColor4=randomColor({luminosity:"random",format:"rgbArray"}),this.reloadLayer()},resetZoom:function(){map.setView([0,-90],2)}};window.onload=function(){console.log(randomColor({luminosity:"bright",format:"rgbArray"}));var e=new dat.GUI({autoPlace:!1}),r=document.getElementById("controls");r.appendChild(e.domElement);var o=e.add(fractalController.appControls,"type",["mandlebrot","julia","burningShip","multibrot3","multibrot4","juliacubed"]),l=e.add(fractalController.appControls,"colorPreset",["YourColor","grayscale","orange","blue","rainbow","wobniar","test"]),t=e.addColor(fractalController.appControls,"fractalColor1").listen(),n=e.addColor(fractalController.appControls,"fractalColor2").listen(),a=e.addColor(fractalController.appControls,"fractalColor3").listen(),s=e.addColor(fractalController.appControls,"fractalColor4").listen(),i=e.add(fractalController.appControls,"maxItt",1,1e3).step(5),c=e.add(fractalController.appControls,"juliaCI",-2,-.01),u=e.add(fractalController.appControls,"juliaCR",.1,1);e.add(fractalController,"randomizeColors"),e.add(fractalController,"resetZoom"),o.onFinishChange(function(e){fractalController.setLayer(e),map.setView([0,-90],2)}),t.onFinishChange(function(){"YourColor"==fractalController.appControls.colorPreset&&fractalController.reloadLayer()}),n.onFinishChange(function(){"YourColor"==fractalController.appControls.colorPreset&&fractalController.reloadLayer()}),a.onFinishChange(function(){"YourColor"==fractalController.appControls.colorPreset&&fractalController.reloadLayer()}),s.onFinishChange(function(){"YourColor"==fractalController.appControls.colorPreset&&fractalController.reloadLayer()}),i.onFinishChange(function(){fractalController.reloadLayer()}),c.onFinishChange(function(){"julia"==fractalController.currentType&&fractalController.reloadLayer()}),u.onFinishChange(function(){"julia"==fractalController.currentType&&fractalController.reloadLayer()}),l.onFinishChange(function(){fractalController.reloadLayer()}),fractalController.setLayer("mandlebrot")};